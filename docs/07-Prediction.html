<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Prediction – Data Science for Political Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-Loops.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9becf3fbc736aa3d8123452166bd44f5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-Prediction.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Political Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Description</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-CausalityI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Causation with Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Causalityii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Causality with Non-Experimental Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Prediction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Section Contents</h2>
   
  <ul>
  <li><a href="#prediction-overview" id="toc-prediction-overview" class="nav-link active" data-scroll-target="#prediction-overview"><span class="header-section-number">7.1</span> Prediction Overview</a></li>
  <li><a href="#process-of-prediction" id="toc-process-of-prediction" class="nav-link" data-scroll-target="#process-of-prediction"><span class="header-section-number">7.2</span> Process of Prediction</a></li>
  <li><a href="#example-forecasting-2024-us-election-based-on-2020-results" id="toc-example-forecasting-2024-us-election-based-on-2020-results" class="nav-link" data-scroll-target="#example-forecasting-2024-us-election-based-on-2020-results"><span class="header-section-number">7.3</span> Example: Forecasting 2024 US Election based on 2020 Results</a>
  <ul>
  <li><a href="#choose-approach" id="toc-choose-approach" class="nav-link" data-scroll-target="#choose-approach"><span class="header-section-number">7.3.1</span> Choose Approach</a></li>
  <li><a href="#assess-accuracy" id="toc-assess-accuracy" class="nav-link" data-scroll-target="#assess-accuracy"><span class="header-section-number">7.3.2</span> Assess Accuracy</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">7.3.3</span> Classification</a></li>
  <li><a href="#iterate-to-improve-predictions" id="toc-iterate-to-improve-predictions" class="nav-link" data-scroll-target="#iterate-to-improve-predictions"><span class="header-section-number">7.3.4</span> Iterate to improve predictions</a></li>
  </ul></li>
  <li><a href="#polling-as-predictive" id="toc-polling-as-predictive" class="nav-link" data-scroll-target="#polling-as-predictive"><span class="header-section-number">7.4</span> Polling as Predictive</a>
  <ul>
  <li><a href="#choose-an-approach-lets-use-some-polls" id="toc-choose-an-approach-lets-use-some-polls" class="nav-link" data-scroll-target="#choose-an-approach-lets-use-some-polls"><span class="header-section-number">7.4.1</span> Choose an Approach: Let’s use some polls!</a></li>
  <li><a href="#imagine-the-process-for-one-state" id="toc-imagine-the-process-for-one-state" class="nav-link" data-scroll-target="#imagine-the-process-for-one-state"><span class="header-section-number">7.4.2</span> Imagine the process for one state</a></li>
  <li><a href="#loop-through-all-states" id="toc-loop-through-all-states" class="nav-link" data-scroll-target="#loop-through-all-states"><span class="header-section-number">7.4.3</span> Loop through all states</a></li>
  <li><a href="#check-accuracy" id="toc-check-accuracy" class="nav-link" data-scroll-target="#check-accuracy"><span class="header-section-number">7.4.4</span> Check Accuracy</a>
  <ul class="collapse">
  <li><a href="#quantitative-measures-of-accuracy" id="toc-quantitative-measures-of-accuracy" class="nav-link" data-scroll-target="#quantitative-measures-of-accuracy"><span class="header-section-number">7.4.4.1</span> Quantitative Measures of Accuracy</a></li>
  <li><a href="#classification-1" id="toc-classification-1" class="nav-link" data-scroll-target="#classification-1"><span class="header-section-number">7.4.4.2</span> Classification</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="prediction" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this section, we move to our next social science goal</p>
<ul>
<li>Describe</li>
<li>Explain, evaluate, and recommend <span class="math inline">\(\rightarrow\)</span> Causality</li>
<li><strong><em>Predict</em></strong></li>
<li>Discover</li>
</ul>
<p>Most of the tools we have been working on thus far have focused on first describing our data and then conducting tests through different types of comparisons and visualizations, in order to assess a deductive hypothesis, explaining the relationship between two variables.</p>
<p>Now we turn to a different goal.</p>
<p>Recall the difference between Correlation vs.&nbsp;Causality using our graphic showing the popularity of <em>Duck Dynasty</em> in different parts of the country. In 2016, researchers at the <a href="https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html">NY Times</a> noticed that areas in the country where the television show Duck Dynasty was popular also tended to support Donald Trump at higher rates.</p>
<p><img src="images/duckdynasty.png" class="img-fluid" style="width:70.0%"></p>
<p>For those used to working with the goal of explanation, shifting to prediction and classification may mean we need to shift what types of information we think is important.</p>
<ul>
<li>Correlation: Areas that watch Duck Dynasty are more likely to support Trump (degree to which two variables ``move together”)</li>
<li>Causality: Watching Duck Dynasty (vs.&nbsp;not watching) causes you to support Trump.</li>
</ul>
<p>If we were interested in the goal of explaining voting decisions (what causes someone to vote a certain way?), we might not care if someone watches the show. However, if we were just interested in predicting vote share or voting decisions, a strong correlation could still be useful. Without spending a single dollar on surveying a community, we might have a general sense of their support for a candidate.</p>
<section id="prediction-overview" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="prediction-overview"><span class="header-section-number">7.1</span> Prediction Overview</h2>
<p>Our goal: Predict (estimate/guess) some unknown using information we have as accurately and precisely as possible</p>
<ul>
<li>Prediction could involve estimating a numeric outcome. Alternatively, prediction also involves classification– predicting a categorical outcome (e.g., prediction of who wins vs.&nbsp;who loses).</li>
</ul>
<p>Some political science examples of this might include</p>
<ol type="1">
<li>Categorizing comments on social media as being toxic/nasty/uncivil</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/instagramhate.png" class="img-fluid figure-img"></p>
<figcaption>Wired</figcaption>
</figure>
</div>
<ol start="2" type="1">
<li>Detecting Fake news and misinformation</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fakenewsai.png" class="img-fluid figure-img"></p>
<figcaption>PBS</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li>Forecasting election results</li>
</ol>
<p><img src="images/forecast24.png" class="img-fluid"></p>
<p>Other examples</p>
<ul>
<li>Trying to detect hate speech online</li>
<li>Predicting where or when an attack might occur</li>
<li>Trying to classify a large amount of text into subject or topic categories for analysis</li>
</ul>
<p>What other types of things might we try to predict or classify in political science?</p>
</section>
<section id="process-of-prediction" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="process-of-prediction"><span class="header-section-number">7.2</span> Process of Prediction</h2>
<p>Predict (estimate/guess) some unknown using information we have – and do so as accurately and precisely as possible.</p>
<ol type="1">
<li>Choose an approach
<ul>
<li>Using an observed (known) measure as a direct proxy to predict an outcome</li>
<li>Using one or more observed (known) measures in a regression model to predict an outcome</li>
<li>(Beyond the course) Using a statistical model to select the measures to use for predicting an outcome</li>
</ul></li>
<li>Assess accuracy and precision
<ul>
<li>Prediction error: <span class="math inline">\(Prediction - Truth\)</span></li>
<li>Bias: Average prediction error: <span class="math inline">\(\text{mean}(Prediction - Truth)\)</span>
<ul>
<li>A prediction is `unbiased’ if the bias is zero (If the prediction is on average true)</li>
</ul></li>
<li>Root-mean squared error: <span class="math inline">\(\sqrt{\text{mean}((Prediction - Truth)^2)}\)</span>
<ul>
<li>Like `absolute’ error– the average magnitude of the prediction error</li>
<li>the typical distance the prediction is from the truth</li>
</ul></li>
<li>Confusion Matrix
<ul>
<li>A cross-tab of predictions you got correct vs.&nbsp;predictions you got wrong (misclassified)</li>
<li>Gives you true positives and true negatives vs.&nbsp;false positives and false negatives</li>
</ul></li>
</ul></li>
<li>Iterate to improve the prediction/classification
<ul>
<li>Often, we repeat steps 1-3 until we are confident in your method for predicting.</li>
</ul></li>
<li>Danger Zone: Eventually, after you have tested the approach and are satisfied with the accuracy, you may start applying it to new data for which you do not know the right answer.</li>
</ol>
</section>
<section id="example-forecasting-2024-us-election-based-on-2020-results" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="example-forecasting-2024-us-election-based-on-2020-results"><span class="header-section-number">7.3</span> Example: Forecasting 2024 US Election based on 2020 Results</h2>
<p>Let’s try to predict the 2024 election results using just the 2020 results.</p>
<p><em>For a video explainer of the code for a similar application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/zWDxZogRwOs" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>results2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"elecresults24.csv"</span>, <span class="at">stringsAsFactors =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables</p>
<ul>
<li><code>state_abbrev</code> and <code>state</code>: state or state and district</li>
<li><code>called2024</code>: result of 2024 election, R or D</li>
<li><code>called2020</code>: result of 2020 election, R or D</li>
<li><code>called2016</code>: result of 2016 election, R or D</li>
<li><code>dem_percent24</code>: percentage for the Democratic candidate</li>
<li><code>rep_percent24</code>: percentage for the Republican candidate</li>
<li><code>dem_percent20</code>: percentage for the Democratic candidate</li>
<li><code>rep_percent20</code>: percentage for the Republican candidate</li>
<li><code>ev_total</code>: Electoral votes associated with a state/ district of a state during the 2024 election</li>
</ul>
<p><img src="images/results24map.png" class="img-fluid" style="width:80.0%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2024<span class="sc">$</span>ev_total[results2024<span class="sc">$</span>called2024 <span class="sc">==</span> <span class="st">"R"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 312</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2024<span class="sc">$</span>ev_total[results2024<span class="sc">$</span>called2024 <span class="sc">==</span> <span class="st">"D"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 226</code></pre>
</div>
</div>
<section id="choose-approach" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="choose-approach"><span class="header-section-number">7.3.1</span> Choose Approach</h3>
<ol type="1">
<li>Choose an approach: Using an observed (known) measure as a direct proxy to predict an outcome</li>
</ol>
<ul>
<li>Let’s use the 2020 result as a direct proxy to predict 2024.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>results2024<span class="sc">$</span>predicted2024 <span class="ot">&lt;-</span> results2024<span class="sc">$</span>called2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assess-accuracy" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="assess-accuracy"><span class="header-section-number">7.3.2</span> Assess Accuracy</h3>
<ol start="2" type="1">
<li>Assess accuracy</li>
</ol>
<p>What proportion of states did we get correct?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results2024<span class="sc">$</span>predicted2024 <span class="sc">==</span> results2024<span class="sc">$</span>called2024)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8928571</code></pre>
</div>
</div>
</section>
<section id="classification" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="classification"><span class="header-section-number">7.3.3</span> Classification</h3>
<p>We want to correctly predict the winner of each state</p>
<p>Prediction of binary outcome variable = classification problem</p>
<ul>
<li><strong>true positive</strong>: correctly predicting Trump to be the winner</li>
<li><strong>false positive </strong>: incorrectly predicting Trump to be the winner (misclassification)</li>
<li><strong>true negative </strong>: correctly predicting Trump to be the loser</li>
<li><strong>false negative </strong>: incorrectly predicting Trump to be the loser (misclassification)</li>
</ul>
<p>We define one outcome as the “positive” and one as the “negative.” For now, we will say a Trump win is the positive and a Harris win is the negative. This terminology comes from settings where a positive result just means “an event has occurred” (e.g., a positive medical test result might mean, yes, you broke your leg). You could flip this and make a Harris win the positive and a Trump win the negative as long as you interpret things correctly.</p>
<p>Confusion Matrix: Tells us how we went right, how we went wrong.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted=</span>results2024<span class="sc">$</span>predicted2024, <span class="at">actual =</span> results2024<span class="sc">$</span>called2024)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         actual
predicted  D  R
        D 22  6
        R  0 28</code></pre>
</div>
</div>
<p>Which states did we get wrong?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>results2024<span class="sc">$</span>state[results2024<span class="sc">$</span>predicted2024 <span class="sc">!=</span> results2024<span class="sc">$</span>called2024]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Arizona      Georgia      Michigan     Nevada       Pennsylvania
[6] Wisconsin   
56 Levels: Alabama Alaska Arizona Arkansas California Colorado ... Wyoming</code></pre>
</div>
</div>
</section>
<section id="iterate-to-improve-predictions" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="iterate-to-improve-predictions"><span class="header-section-number">7.3.4</span> Iterate to improve predictions</h3>
<p>Start back at step one. We continue to repeat steps 1 and 2 until we are confident in our predictions.</p>
<p>How could we improve our predictions of elections? What other information could we use?</p>
</section>
</section>
<section id="polling-as-predictive" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="polling-as-predictive"><span class="header-section-number">7.4</span> Polling as Predictive</h2>
<p>Many forecasters use pre-election polls in their models to predict election outcomes. In 2016 and 2020, polling-based forecasts received a lot of criticism</p>
<p>Prior to the 2016 elections, forecasts that used polls seemed confident that Hillary Clinton would win the election. <a href="https://www.youtube.com/watch?v=zerWCVpXTr8">Political analysts</a> also seemed to think the polls were favorable to Clinton.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clintonupshot.png" class="img-fluid figure-img"></p>
<figcaption><em>NY Upshot</em></figcaption>
</figure>
</div>
<p>We all know that afterwards, Clinton did not win.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/afterpolls.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption><em>Pew</em></figcaption>
</figure>
</div>
<p>This led public opinion scholars and practitioners to do a deep investigation into the quality of pre-election polling. Like 2016, following the 2020 election, a similar team investigated the quality of pre-election polling in 2020. Here, while many polls pointed to a favorable outcome for Biden, the results seemed closer than one might have anticipated.</p>
<p><img src="images/aaportitle.png" class="img-fluid"></p>
<p>The results of these findings are in the <a href="https://www.aapor.org/AAPOR_Main/media/MainSiteFiles/AAPOR-Task-Force-on-2020-Pre-Election-Polling_Report-FNL.pdf">AAPOR report</a>.</p>
<section id="choose-an-approach-lets-use-some-polls" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="choose-an-approach-lets-use-some-polls"><span class="header-section-number">7.4.1</span> Choose an Approach: Let’s use some polls!</h3>
<p>We will load polls from the 2024 election cycle. This cycle was unique because we had a change in candidates somewhat late in the campaign. Not all states were able to conduct polls with Harris on the ballot, and even if they did, not all polling aggregators have included data from these polls.</p>
<p>As a results, our polling dataset is somewhat incomplete. It contains polls only from states we might think are more competitive, or at least, more likely to be polled in an election.</p>
<p>In this next exercise, we will break our prediction activitiy into two sections. For states with polls available, we will make polling-based predictions for every state. For states without polls, we will rely on the 2016 party result as our prediction. We then combine both to get a prediction for the full election.</p>
<p>Let’s load the data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>polls24 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"polls24bothsources.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables</p>
<ul>
<li><code>Harris</code>, <code>Trump</code>, poll-based percent going for each candidate</li>
<li><code>state</code>: state or state and district</li>
<li><code>samplesize</code>: sample size of the poll</li>
<li><code>sampletype</code>: if it was a poll of likely voters, registered voters, or some other population</li>
<li><code>daystoelection</code>: how close we are to 11/5/2024</li>
<li><code>called2024</code>: result of 2024 election, R or D</li>
<li><code>called2020</code>: result of 2020 election, R or D</li>
<li><code>called2016</code>: result of 2016 election, R or D</li>
<li><code>dem_percent24</code>: percentage for the Democratic candidate</li>
<li><code>rep_percent24</code>: percentage for the Republican candidate</li>
<li><code>dem_percent20</code>: percentage for the Democratic candidate</li>
<li><code>rep_percent20</code>: percentage for the Republican candidate</li>
<li><code>ev_total</code>: Electoral votes associated with a state/ district of a state during the 2024 election</li>
</ul>
<p>Let’s make a variable that shows us the predicted margin for Trump based on the poll in a given row, and a variable for the actual margin on Election Day.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>polls24<span class="sc">$</span>pollmargin24 <span class="ot">&lt;-</span> polls24<span class="sc">$</span>Trump <span class="sc">-</span> polls24<span class="sc">$</span>Harris</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>polls24<span class="sc">$</span>resultmargin24 <span class="ot">&lt;-</span> polls24<span class="sc">$</span>rep_percent2024 <span class="sc">-</span> polls24<span class="sc">$</span>dem_percent2024</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also see what states are in our polling data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls24<span class="sc">$</span>state)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>states</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Arizona"        "Florida"        "Georgia"        "Iowa"          
 [5] "Michigan"       "Minnesota"      "Nevada"         "New Hampshire" 
 [9] "North Carolina" "Pennsylvania"   "Texas"          "Virginia"      
[13] "Wisconsin"      "California"     "Illinois"       "Maine"         
[17] "Maine CD-1"     "Maine CD-2"     "Maryland"       "Missouri"      
[21] "Montana"        "Nebraska"       "Nebraska CD-2"  "New Mexico"    
[25] "New York"       "Ohio"           "Oregon"         "Tennessee"     
[29] "Utah"           "Vermont"        "Washington"     "West Virginia" </code></pre>
</div>
</div>
</section>
<section id="imagine-the-process-for-one-state" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="imagine-the-process-for-one-state"><span class="header-section-number">7.4.2</span> Imagine the process for one state</h3>
<p>For each state with polling data, we will make our prediction for the election by taking the average of the most recent polls in the state. We will define this as all polls within 15 days of the election, or, if some states only had polls taken much earlier, we will grab whatever the most recent poll’s result was.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset to just Arizona</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Arizona"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls24, state <span class="sc">==</span> states[<span class="dv">1</span>])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Further subset to the "latest polls"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, daystoelection <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                      daystoelection <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>daystoelection) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s extract the actual margin for Trump, the poll-based predicted margin, and finally, let’s assign electoral votes based on our prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for the actual result</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>result.marginAZ <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultmargin24)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>result.marginAZ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0552723</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for our prediction</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>polls.marginAZ <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>pollmargin24)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>polls.marginAZ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02588636</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Allocate votes for Biden according to the margin</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>trumpvotesAZ <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>pollmargin24) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>ev_total), <span class="dv">0</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>trumpvotesAZ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
<p>We predicted Trump would win Arizona because the <code>polls.marginAZ</code> is positive. Therefore, we assigned Trump 11 electoral votes in this example.</p>
</section>
<section id="loop-through-all-states" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="loop-through-all-states"><span class="header-section-number">7.4.3</span> Loop through all states</h3>
<p>Now let’s repeat this process for all states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls24<span class="sc">$</span>state)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Container vectors</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>polls.margin24 <span class="ot">&lt;-</span> result.margin24 <span class="ot">&lt;-</span> trumpvotes_pred <span class="ot">&lt;-</span> trumpvotes_act <span class="ot">&lt;-</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(states))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(polls.margin24) <span class="ot">&lt;-</span> <span class="fu">names</span>(result.margin24) <span class="ot">&lt;-</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(trumpvotes_pred) <span class="ot">&lt;-</span> <span class="fu">names</span>(trumpvotes_act)  <span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">unique</span>(states))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(states)){</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls24, state <span class="sc">==</span> states[i] )</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, daystoelection <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                      daystoelection <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>daystoelection) )</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  result.margin24[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultmargin24)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  polls.margin24[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>pollmargin24)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  trumpvotes_pred[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>pollmargin24) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>ev_total), <span class="dv">0</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  trumpvotes_act[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>resultmargin24) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>ev_total), <span class="dv">0</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trumpvotes_pred) <span class="co"># predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 198</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trumpvotes_act) <span class="co"># predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 224</code></pre>
</div>
</div>
<p><strong><em>Less competitive states</em></strong></p>
<p>We also need to assign Trump votes to states not included in the poll data. Here, we will continue to predict based on the results of the 2020 election.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset only states without polling data for Harris</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>elecresults_noncomp <span class="ot">&lt;-</span> <span class="fu">subset</span>(results2024, (<span class="sc">!</span> state <span class="sc">%in%</span> states))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted EV</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>trumpvotes_lesscomp_pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(elecresults_noncomp<span class="sc">$</span>called2020 <span class="sc">==</span> <span class="st">"R"</span>, elecresults_noncomp<span class="sc">$</span>ev_total, <span class="dv">0</span>) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(trumpvotes_lesscomp_pred) <span class="ot">&lt;-</span> elecresults_noncomp<span class="sc">$</span>state</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">## actual EV</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>trumpvotes_lesscomp_result <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(elecresults_noncomp<span class="sc">$</span>called2024 <span class="sc">==</span> <span class="st">"R"</span>, elecresults_noncomp<span class="sc">$</span>ev_total, <span class="dv">0</span>) </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(trumpvotes_lesscomp_result) <span class="ot">&lt;-</span> elecresults_noncomp<span class="sc">$</span>state</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted Trump votes from less competitive states vs. actual</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trumpvotes_lesscomp_pred) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(trumpvotes_lesscomp_result) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88</code></pre>
</div>
</div>
<p>The overall prediction combines the less competitive and competitive states:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>predictedEV <span class="ot">&lt;-</span> <span class="fu">c</span>(trumpvotes_lesscomp_pred,trumpvotes_pred)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(predictedEV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>actualEV <span class="ot">&lt;-</span> <span class="fu">c</span>(trumpvotes_lesscomp_result, trumpvotes_act)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(actualEV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 312</code></pre>
</div>
</div>
</section>
<section id="check-accuracy" class="level3" data-number="7.4.4">
<h3 data-number="7.4.4" class="anchored" data-anchor-id="check-accuracy"><span class="header-section-number">7.4.4</span> Check Accuracy</h3>
<section id="quantitative-measures-of-accuracy" class="level4" data-number="7.4.4.1">
<h4 data-number="7.4.4.1" class="anchored" data-anchor-id="quantitative-measures-of-accuracy"><span class="header-section-number">7.4.4.1</span> Quantitative Measures of Accuracy</h4>
<p>From the polls, let’s calculate two common measures of prediction error: bias (the average prediction error) and root-mean-squared error (a typical magnitude of the prediction error).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Bias (Predicted Trump - True Trump)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>predictionerror <span class="ot">&lt;-</span> polls.margin24 <span class="sc">-</span>result.margin24 </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictionerror)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>bias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.03228962</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Root Mean Squared Error</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((predictionerror)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06040716</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of Prediction Errors to Show Bias</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(predictionerror, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prediction Error (Predicted Trump Margin - Actual)"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of Prediction Error in Latest Polls"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(predictionerror), <span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-Prediction_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What do these results suggest about the polls?</p>
</section>
<section id="classification-1" class="level4" data-number="7.4.4.2">
<h4 data-number="7.4.4.2" class="anchored" data-anchor-id="classification-1"><span class="header-section-number">7.4.4.2</span> Classification</h4>
<p>Instead of quantifying how far we were off, let’s see where we were right vs.&nbsp;where we were wrong.</p>
<p>Classification</p>
<ul>
<li>true positive: correctly predicting Trump to be the winner</li>
<li>false positive: incorrectly predicting Trump to be the winner</li>
<li>true negative: correctly predicting Trump to be the loser</li>
<li>false negative: incorrectly predicting Trump to be the loser</li>
</ul>
<p>Confusion Matrix</p>
<p>Let’s classify our predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>actualwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(trumpvotes_act <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Trump Won"</span>, <span class="st">"Harris Won"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>predictedwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(trumpvotes_pred <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Trump Won"</span>, <span class="st">"Harris Won"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predictedwins, actualwins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             actualwins
predictedwins Harris Won Trump Won
   Harris Won         14         3
   Trump Won           0        15</code></pre>
</div>
</div>
<p>Where did the polls get it wrong?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>actualwins[actualwins <span class="sc">!=</span> predictedwins]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Michigan   Wisconsin  Maine CD-2 
"Trump Won" "Trump Won" "Trump Won" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>trumpvotes_act[actualwins <span class="sc">!=</span> predictedwins]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Michigan  Wisconsin Maine CD-2 
        15         10          1 </code></pre>
</div>
</div>
<p>What’s your conclusion?</p>
<ul>
<li>Are the polls alright?</li>
<li>How could you improve the prediction?</li>
<li>Wait a second… why even poll?</li>
</ul>
<p>Nate Silver’s analysis of the 2025 polls is available here:https://www.natesilver.net/p/so-how-did-the-polls-do-in-2024-its</p>
<p><img src="images/silver24pollerror.png" class="img-fluid"></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-Loops.html" class="pagination-link" aria-label="Loops in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>