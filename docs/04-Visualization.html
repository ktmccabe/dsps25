<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Visualization – Data Science for Political Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-Causalityii.html" rel="next">
<link href="./03-CausalityI.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9becf3fbc736aa3d8123452166bd44f5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-Visualization.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Political Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Description</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-CausalityI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Causation with Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Visualization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Causalityii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Causality with Non-Experimental Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Prediction with Regression</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Section Contents</h2>
   
  <ul>
  <li><a href="#application-social-status-and-economic-views" id="toc-application-social-status-and-economic-views" class="nav-link active" data-scroll-target="#application-social-status-and-economic-views"><span class="header-section-number">4.1</span> Application: Social Status and Economic Views</a></li>
  <li><a href="#boxplots" id="toc-boxplots" class="nav-link" data-scroll-target="#boxplots"><span class="header-section-number">4.2</span> Boxplots</a>
  <ul>
  <li><a href="#data-summary-boxplot" id="toc-data-summary-boxplot" class="nav-link" data-scroll-target="#data-summary-boxplot"><span class="header-section-number">4.2.1</span> Data Summary: Boxplot</a></li>
  </ul></li>
  <li><a href="#barplots" id="toc-barplots" class="nav-link" data-scroll-target="#barplots"><span class="header-section-number">4.3</span> Barplots</a>
  <ul>
  <li><a href="#saving-plots" id="toc-saving-plots" class="nav-link" data-scroll-target="#saving-plots"><span class="header-section-number">4.3.1</span> Saving Plots</a></li>
  <li><a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables"><span class="header-section-number">4.3.2</span> Creating New Variables</a></li>
  </ul></li>
  <li><a href="#application-changing-minds-on-gay-marriage" id="toc-application-changing-minds-on-gay-marriage" class="nav-link" data-scroll-target="#application-changing-minds-on-gay-marriage"><span class="header-section-number">4.4</span> Application: Changing Minds on Gay Marriage</a>
  <ul>
  <li><a href="#recall-creating-new-variables" id="toc-recall-creating-new-variables" class="nav-link" data-scroll-target="#recall-creating-new-variables"><span class="header-section-number">4.4.1</span> Recall: Creating new variables</a></li>
  <li><a href="#recall-using-ifelse-to-create-new-variable" id="toc-recall-using-ifelse-to-create-new-variable" class="nav-link" data-scroll-target="#recall-using-ifelse-to-create-new-variable"><span class="header-section-number">4.4.2</span> Recall: Using ifelse to create new variable</a></li>
  <li><a href="#calculating-the-average-treatment-effect" id="toc-calculating-the-average-treatment-effect" class="nav-link" data-scroll-target="#calculating-the-average-treatment-effect"><span class="header-section-number">4.4.3</span> Calculating the Average Treatment Effect</a></li>
  <li><a href="#visualize-means-in-a-barplot" id="toc-visualize-means-in-a-barplot" class="nav-link" data-scroll-target="#visualize-means-in-a-barplot"><span class="header-section-number">4.4.4</span> Visualize means in a barplot</a></li>
  </ul></li>
  <li><a href="#scatterplots" id="toc-scatterplots" class="nav-link" data-scroll-target="#scatterplots"><span class="header-section-number">4.5</span> Scatterplots</a></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms"><span class="header-section-number">4.6</span> Histograms</a>
  <ul>
  <li><a href="#happy-research-ending" id="toc-happy-research-ending" class="nav-link" data-scroll-target="#happy-research-ending"><span class="header-section-number">4.6.1</span> Happy research ending</a></li>
  </ul></li>
  <li><a href="#line-plots" id="toc-line-plots" class="nav-link" data-scroll-target="#line-plots"><span class="header-section-number">4.7</span> Line Plots</a></li>
  <li><a href="#application-trends-during-covid" id="toc-application-trends-during-covid" class="nav-link" data-scroll-target="#application-trends-during-covid"><span class="header-section-number">4.8</span> Application: Trends during COVID</a></li>
  <li><a href="#visual-tips-and-tricks" id="toc-visual-tips-and-tricks" class="nav-link" data-scroll-target="#visual-tips-and-tricks"><span class="header-section-number">4.9</span> Visual tips and tricks</a></li>
  <li><a href="#common-r-plotting-functions-and-arguments" id="toc-common-r-plotting-functions-and-arguments" class="nav-link" data-scroll-target="#common-r-plotting-functions-and-arguments"><span class="header-section-number">4.10</span> Common R plotting functions and arguments</a></li>
  <li><a href="#a-note-on-ggplot" id="toc-a-note-on-ggplot" class="nav-link" data-scroll-target="#a-note-on-ggplot"><span class="header-section-number">4.11</span> A note on <code>ggplot</code></a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="visualization" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this section, we discuss a set of tools for data visualization in R.</p>
<p>Goals of data visualization</p>
<ul>
<li>Communicate information
<ul>
<li>Transparently (show me the data!)</li>
<li>Quickly</li>
<li>Simply</li>
<li>Accurately</li>
<li>And with a little work: beautifully</li>
</ul></li>
</ul>
<p>There are many resources for ideas and best practices for data visualization. See <a href="https://www.tableau.com/learn/articles/best-data-visualization-blogs">here</a> and <a href="https://serialmentor.com/dataviz/index.html">here</a>.</p>
<p>We will cover many types of visuals, each typically designed for a different purpose.</p>
<p>What to communicate?</p>
<ul>
<li>Data summary
<ul>
<li>Central tendency (e.g., mean, median)</li>
<li>Spread (e.g., standard deviation, IQR)</li>
</ul></li>
<li>Comparison
<ul>
<li>e.g., Callback rates for black vs.&nbsp;white sounding names</li>
</ul></li>
<li>Trend
<ul>
<li>e.g., Economic confidence over time</li>
</ul></li>
<li>Relationship
<ul>
<li>e.g., Correlation</li>
</ul></li>
</ul>
<section id="application-social-status-and-economic-views" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="application-social-status-and-economic-views"><span class="header-section-number">4.1</span> Application: Social Status and Economic Views</h2>
<p>We are going to explore different types of visualizations through different social science examples. The first application we visit is a survey experiment.</p>
<p>Thal, A. (2020). The desire for social status and economic conservatism among affluent Americans. American Political Science Review, 114(2), 426-442.</p>
<p>In the experiment, affluent Americans are randomly assigned to encounter Facebook posts in which others broadcast their economic success. These posts are designed in a way that encourages affluent respondents to view economic success as a means of achieving social status.</p>
<p>Causal claims</p>
<ul>
<li>“I expect that exposure to these posts will cause affluent Americans to become more supportive of conservative economic policies.”</li>
<li>“I also expect that exposure to these posts will cause especially large increases in economic conservatism among affluent men.”</li>
</ul>
<p>The experiment includes a sample of 2010 affluent Americans– people who report household incomes in the top 10 percent of the U.S. income distribution.</p>
<p>Experiment Ingredients:</p>
<ul>
<li>Causal Question: Does desire for social status influence economic views of affluent Americans?</li>
<li>Recruitment: Ask affluent Americans to take a survey online</li>
<li>Randomization: Randomly assign respondents to view different fictional Facebook posts designed to signal different motivations</li>
<li>Outcome: an index based on respondents’ support for decreasing “taxes on households making $150,000 or more a year,” support for decreasing the “taxes on money people make from selling investments, also referred to as capital gains,” and support for decreasing “government regulation of business and industry.”</li>
<li>Comparison: Average economic views between experimental conditions.</li>
</ul>
<p>Snapshot of status conditions</p>
<p><img src="images/status1.png" class="img-fluid" style="width:70.0%"></p>
<p>Snapshot of Concrete and Placebo comparison conditions</p>
<p><img src="images/status2.png" class="img-fluid" style="width:70.0%"></p>
<p><strong>Can you put this into the potential outcomes framework?</strong></p>
</section>
<section id="boxplots" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="boxplots"><span class="header-section-number">4.2</span> Boxplots</h2>
<p>For a video explainer of the code for boxplots and barplots, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/QmQr4lfrmUc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Let’s load the data! Here, note that the data file is in a .RData format instead of .csv. This means that instead of using <code>read.csv</code>, we should use a function to load the data that is suitable for the .RData format. This will be <code>load</code>. That function works the following way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"status.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running the above code, an object will show up in your R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        condition male   econcon
2        Concrete    1 0.7500000
3     Self-Esteem    1 1.0000000
4         Placebo    1 0.6666667
5     Self-Esteem    0 0.2500000
6     Self-Esteem    0 1.0000000
7 Social Approval    0 0.8333333</code></pre>
</div>
</div>
<p>The data include the following variables</p>
<ul>
<li><code>condition</code>: Placebo, Concrete, Self-Esteem, Social Approval, Conspicuous Consumption</li>
<li><code>gender</code>: 1= male; 0= otherwise</li>
<li><code>econcon</code>: Economic views. Numeric variable from 0 to 1, with higher values reflecting more conservative views</li>
</ul>
<section id="data-summary-boxplot" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="data-summary-boxplot"><span class="header-section-number">4.2.1</span> Data Summary: Boxplot</h3>
<p>Characterize the distributions of continuous numeric variables at once</p>
<ul>
<li>Features: box, whiskers, outliers</li>
<li>We will supply the function with a column in our data, and the boxplot displays the distribution of that variable.</li>
</ul>
<p><img src="images/agebox.png" class="img-fluid" style="width:80.0%"></p>
<p><em>Figure from Will Lowe</em></p>
<p>Here is an example of the <code>boxplot</code> using our <code>econcon</code> variable.</p>
<ul>
<li>We have added a title and y-axis label to the plot through the <code>main</code> and <code>ylab</code> arguments. Play around with changing the words in those arguments.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(status<span class="sc">$</span>econcon,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Economic Views in the Survey Sample"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">"Economic Views"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>After you execute the plot code, a preview of the plot should appear in the bottom-right window of RStudio.</p>
<p>Boxplots are also useful for data summary across multiple distribution: <code>boxplot(y ~ x, data = d)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(econcon <span class="sc">~</span> condition, <span class="at">data=</span>status,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Economic Views by Experimental Condition"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">"Economic Views"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Concrete"</span>, <span class="st">"Conspicuous"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Self-Esteem"</span>, <span class="st">"Social"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Experimental Condition"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red3"</span>, <span class="fu">rep</span>(<span class="st">"dodgerblue"</span>, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="1056"></p>
</figure>
</div>
</div>
</div>
<p>The additional arguments are just aesthetics. Play around with different settings.</p>
<ul>
<li>For example, can you change the code to make the first two boxes red? Colors are supplied as a vector using the <code>col =</code> argument.
<ul>
<li>To explore colors in R, run this function <code>colors()</code> in your R console.</li>
</ul></li>
</ul>
<p>How should we interpret these results? Does status or social approval motivation, specifically, influence economic views? What about other potential motivations?</p>
</section>
</section>
<section id="barplots" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="barplots"><span class="header-section-number">4.3</span> Barplots</h2>
<p>Comparing frequencies (raw N), proportions, and/or means across categories</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We will use the <code>barplot()</code> function.</p>
<ul>
<li>In contrast to the boxplot, the barplot function takes a vector of values that will serve as the top of the bars in the plot– it does not summarize a variable from within the function
<ul>
<li>E.g., we could supply it a set of means to plot, not a raw variable</li>
</ul></li>
<li>Many of the other arguments are aesthetics similar to those when working with boxplot.</li>
<li>This means that barplots are pretty easy to create in R. We can supply it a short vector of any values (e.g., <code>valuesbar &lt;- c(20, 30, 40, 10)</code>), and we could also supply it a vector of any names to label those values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Example</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>valuesbar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">10</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>namesbar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Livingston Dining </span><span class="sc">\n</span><span class="st"> Commons"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Neilson </span><span class="sc">\n</span><span class="st"> Dining Hall"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Busch </span><span class="sc">\n</span><span class="st"> Dining Hall"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Brower </span><span class="sc">\n</span><span class="st"> Commons"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(valuesbar,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">names=</span>namesbar,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">6</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"Hypothetical Evaluation of RU Dining"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">"Percent Prefer Dining Option"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">7</span>, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">"red3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>-   For real applications, this means we could supply a barplot with the output of a `tapply()` function, a `table()` summarizing a single variable, or a set of `mean()` values we have combined into a vector using `c()`.</code></pre>
<p>For example, in experiments, we may use barplots to compare the mean from the treatment group(s) <span class="math inline">\(\bar{Y}(1)\)</span> to the control <span class="math inline">\(\bar{Y}(0)\)</span> on some outcome. Let’s do it!</p>
<ul>
<li>First, we need the means. Let’s find the conditional means of economic views.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>condmeans <span class="ot">&lt;-</span> <span class="fu">tapply</span>(status<span class="sc">$</span>econcon, status<span class="sc">$</span>condition, mean)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>condmeans <span class="co"># save as object to supply to the barplot function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Placebo                Concrete Conspicuous Consumption 
              0.6340948               0.6647485               0.6724065 
            Self-Esteem         Social Approval 
              0.6564103               0.6904444 </code></pre>
</div>
</div>
<p>The first input is the vector of means/proportions/frequency you want to plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(condmeans,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Concrete"</span>, <span class="st">"Conspicuous"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Self-Esteem"</span>, <span class="st">"Social"</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>, <span class="co"># color of bars</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Mean Economic Views by Condition"</span>, <span class="co"># plot title</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Mean Views"</span>, <span class="co"># yaxis label</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The remaining arguments alter the look of the plot to make it more informative.</p>
<ul>
<li>How could we improve this plot to make the interpretation easier?</li>
</ul>
<section id="saving-plots" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="saving-plots"><span class="header-section-number">4.3.1</span> Saving Plots</h3>
<p>You can save an image of your plot as a <code>png()</code> to your working directory. Place <code>png()</code> just before your plot with a name in quotations, and then specify the dimensions. Place <code>dev.off()</code> at the bottom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"mybarplot.png"</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">res=</span><span class="dv">300</span>, <span class="at">units=</span><span class="st">"in"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(condmeans,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Concrete"</span>, <span class="st">"Conspicuous"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Self-Esteem"</span>, <span class="st">"Social"</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>, <span class="co"># color of bars</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Mean Economic Views by Condition"</span>, <span class="co"># plot title</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Mean Views"</span>, <span class="co"># yaxis label</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can save it as an image, by going to the plot window in your RStudio environment, and clicking on Export -&gt; Save as Image. Here, you can save it in any file format you would like, as well as change the dimensions.</p>
<p><img src="images/saveplot.png" class="img-fluid"></p>
</section>
<section id="creating-new-variables" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="creating-new-variables"><span class="header-section-number">4.3.2</span> Creating New Variables</h3>
<p>The author theorizes that social approval, self-esteem, and conspicuous consumption are all elements of “status motivation.” We could analyze the results by collapsing them into a single category called “status motivation” and compare it to the other experimental groups.</p>
<ul>
<li>Create a new variable <code>conditionnew</code></li>
<li>Code the variable into new categories based on the values in the original <code>condition</code> variable</li>
<li>Check the class of the new variable and convert if necessary</li>
<li>Verify new variable by exploring values</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># create new variable</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Code new variable</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Placebo"</span>] <span class="ot">&lt;-</span> <span class="st">"Placebo"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Concrete"</span>] <span class="ot">&lt;-</span> <span class="st">"Concrete"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew[status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Conspicuous Consumption"</span> <span class="sc">|</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                     status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Self-Esteem"</span> <span class="sc">|</span>  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                      status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Social Approval"</span>] <span class="ot">&lt;-</span> <span class="st">"Status"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># class(status$conditionnew) check the class</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(status<span class="sc">$</span>conditionnew) <span class="co"># convert</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall, an alternative way to create the new variable is through an <code>ifelse</code> statement.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A, otherwise I assign you B</li>
<li>This often works best when we change factor variables to character</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(status<span class="sc">$</span>condition)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Conspicuous Consumption"</span> <span class="sc">|</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                     status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Self-Esteem"</span> <span class="sc">|</span>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                      status<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"Social Approval"</span>, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Status"</span>, status<span class="sc">$</span>conditionnew2)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>status<span class="sc">$</span>conditionnew2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(status<span class="sc">$</span>conditionnew2)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(status<span class="sc">$</span>conditionnew2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Concrete  Placebo   Status 
     391      394     1157 </code></pre>
</div>
</div>
<p>Note: Barplots don’t have to display means. We could also display frequencies. For example, let’s make a plot of the number of people in each condition using our new variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>freqobs <span class="ot">&lt;-</span> <span class="fu">table</span>(status<span class="sc">$</span>conditionnew)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(freqobs,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1200</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"black"</span>, <span class="co"># color of bars</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Number of People per Condition"</span>, <span class="co"># plot title</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> .<span class="dv">8</span>, <span class="co"># size of name labels</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"N of Observations"</span>, <span class="co"># yaxis label</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="application-changing-minds-on-gay-marriage" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="application-changing-minds-on-gay-marriage"><span class="header-section-number">4.4</span> Application: Changing Minds on Gay Marriage</h2>
<p>We now turn to a study that asks the question</p>
<ul>
<li>Research Question Can we effectively persuade people to change their minds?
<ul>
<li><em>Contact Hypothesis</em>: outgroup hostility diminishes through extended positive contact</li>
</ul></li>
</ul>
<p>The authors conduct two randomized control trials in Los Angeles</p>
<ul>
<li><em>Target population</em>: voters in Los Angeles</li>
<li><em>Recruitment</em>: select people from a registered voter list</li>
<li><em>Randomized treatment conditions</em>:
<ul>
<li>Canvassers have a conversation about same-sex marriage vs.</li>
<li>Recycling scripts (placebo)</li>
<li>Control group: no canvassing</li>
</ul></li>
<li><em>Outcome measures</em>:
<ul>
<li>Feeling towards gay couples (survey responses over multiple waves)</li>
</ul></li>
<li><em>Comparison</em>
<ul>
<li>Compare average change in feelings between treatment conditions</li>
</ul></li>
</ul>
<p>Let’s load the data. Data available through QSS. See QSS Chapter 2 for additional discussion.</p>
<ul>
<li><code>study</code>: Which study is the data from (<code>1</code> = Study1, <code>2</code> = Study2)</li>
<li><code>treatment</code>: Five possible treatment assignment options</li>
<li><code>therm1</code>: Survey thermometer rating of feeling towards gay couples in waves 1 (0–100) (asked before people were canvassed)</li>
<li><code>therm2</code>: Survey thermometer rating of feeling towards gay couples in waves 2 (0–100) (asked after people were canvassed)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>marriage <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"gayreshaped.csv"</span>, <span class="at">stringsAsFactors =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many rows and columns</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(marriage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11948     6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## How many observations in each treatment group, in each study</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marriage<span class="sc">$</span>treatment, marriage<span class="sc">$</span>study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                
                                                    1    2
  No Contact                                     5238 1203
  Recycling Script by Gay Canvasser              1046    0
  Recycling Script by Straight Canvasser         1039    0
  Same-Sex Marriage Script by Gay Canvasser      1151 1238
  Same-Sex Marriage Script by Straight Canvasser 1033    0</code></pre>
</div>
</div>
<p>For a video explainer of the code for the barplot, scatter plot and histogram created with this application, see below. The video only discusses the code. Use the notes and lecture discussion for additional context. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/ukexpAulAAk" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Let’s focus on study 1 only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>marriage1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(marriage, study <span class="sc">==</span>  <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have to do some work to prepare our outcome and treatment conditions.</p>
<p>In experiments, we compare the mean from the treatment group(s) <span class="math inline">\(\bar{Y}(1)\)</span> to the control <span class="math inline">\(\bar{Y}(0)\)</span> on some outcome</p>
<ul>
<li>Here are outcome is Change in Support for gay couples: Wave 2 - Wave 1 feeling thermometer scores</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>outcome <span class="ot">&lt;-</span> marriage1<span class="sc">$</span>therm2 <span class="sc">-</span> marriage1<span class="sc">$</span>therm1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="recall-creating-new-variables" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="recall-creating-new-variables"><span class="header-section-number">4.4.1</span> Recall: Creating new variables</h3>
<p>Let’s create a new variable <code>treatmentnew</code> that collapses the two Recycling and Same-Sex marriage conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">"No Contact"</span>] <span class="ot">&lt;-</span> <span class="st">"No Contact"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">"Recycling Script by Gay Canvasser"</span> <span class="sc">|</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                         marriage1<span class="sc">$</span>treatment <span class="sc">==</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Recycling Script by Straight Canvasser"</span>] <span class="ot">&lt;-</span> <span class="st">"Recycling"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew[marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">"Same-Sex Marriage Script by Gay Canvasser"</span> <span class="sc">|</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                         marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Same-Sex Marriage Script by Straight Canvasser"</span>] <span class="ot">&lt;-</span> <span class="st">"Marriage"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(marriage1<span class="sc">$</span>treatmentnew)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marriage1<span class="sc">$</span>treatmentnew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Marriage No Contact  Recycling 
      2184       5238       2085 </code></pre>
</div>
</div>
</section>
<section id="recall-using-ifelse-to-create-new-variable" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="recall-using-ifelse-to-create-new-variable"><span class="header-section-number">4.4.2</span> Recall: Using ifelse to create new variable</h3>
<p>An alternative way we could create a variable is to use <code>ifelse</code></p>
<p>Let’s try another way using the <code>ifelse</code> command.</p>
<ul>
<li>Can be read: If this relational statement is <code>TRUE</code>, I assign you A (in this case “No Contact”), otherwise (<code>ifelse()</code>)</li>
<li>if this alternative relational statement is <code>TRUE</code>, I assign you B (in this case “Recycling”), otherwise (<code>ifelse()</code>)</li>
<li>if this alternative relational statement is <code>TRUE</code>, I assign you C (in this case “Marriage”), otherwise</li>
<li>If all of those were <code>FALSE</code> I assign you D (in this case an <code>NA</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">"No Contact"</span>, <span class="st">"No Contact"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Recycling Script by Gay Canvasser"</span> <span class="sc">|</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                           marriage1<span class="sc">$</span>treatment <span class="sc">==</span>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Recycling Script by Straight Canvasser"</span>,  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Recycling"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Same-Sex Marriage Script by Gay Canvasser"</span> <span class="sc">|</span>  </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                                            marriage1<span class="sc">$</span>treatment <span class="sc">==</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Same-Sex Marriage Script by Straight Canvasser"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Marriage"</span>, </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="cn">NA</span>)))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>marriage1<span class="sc">$</span>treatmentnew2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(marriage1<span class="sc">$</span>treatmentnew2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-the-average-treatment-effect" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="calculating-the-average-treatment-effect"><span class="header-section-number">4.4.3</span> Calculating the Average Treatment Effect</h3>
<p>We now have our outcome and our treatment conditions. In an experiment, we want to look at the difference in means between conditions. Let’s calculate the means.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>outs <span class="ot">&lt;-</span> <span class="fu">tapply</span>(marriage1<span class="sc">$</span>outcome, marriage1<span class="sc">$</span>treatmentnew, mean, <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: Sometimes data include missing cells. In R, these have an <code>NA</code>. To ignore these when calculating a mean, we add <code>na.rm = T</code> to the <code>mean()</code> or <code>tapply()</code> functions.</p>
</section>
<section id="visualize-means-in-a-barplot" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="visualize-means-in-a-barplot"><span class="header-section-number">4.4.4</span> Visualize means in a barplot</h3>
<p>Let’s also add a line at 0 using <code>abline()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(outs,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">"black"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="co"># y-axis dimensions</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span>, <span class="co"># removes bar borders</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Change in FT W2-W1 by Type of Treatment"</span>, <span class="co"># plot title</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> .<span class="dv">8</span>, <span class="co"># size of plot title</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Mean Change in FT W2-W1"</span>, <span class="co"># yaxis label</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> .<span class="dv">8</span>,<span class="co"># size of yaxis label</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">1</span>) <span class="co"># controls angle of axis labels</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>) <span class="co"># adds horizontal line at 0 with dashes </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>How should we interpret these results?</p>
<ul>
<li>In the Marriage condition, it looks like on average, views toward gay couples became warmer (the bar is positive) after the conversations with canvassers about same-sex marriage.</li>
<li>In contrast, the views of people in the Recycling or No Contact conditions did not change much and if anything, became slightly colder.</li>
<li>Comparing between these bars, then, it seems like there is an “average treatment effect” given that the change in the Marriage condition was different from the Recycling an No Contact control groups.</li>
</ul>
</section>
</section>
<section id="scatterplots" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="scatterplots"><span class="header-section-number">4.5</span> Scatterplots</h2>
<p>It turns out that study was completely fabricated, and the article was eventually <a href="https://www.newyorker.com/science/maria-konnikova/how-a-gay-marriage-study-went-wrong">retracted</a>.</p>
<p>How did people know? Well a team of researchers became suspicious based on exploratory analyses they conducted with the data. Let’s do a few of these to learn about scatterplots and histograms.</p>
<p>Scatter plots show the relationship between two numeric variables.</p>
<p>A common way to describe and quantify a relationship is through correlation.</p>
<ul>
<li>Correlation: When <span class="math inline">\(x\)</span> changes, <span class="math inline">\(y\)</span> also changes by a fixed proportion
<ul>
<li>Asks: If you are a certain degree above the mean of <span class="math inline">\(x\)</span>, are you similarly that much above the mean of <span class="math inline">\(y\)</span>?</li>
<li>Positive correlation: data cloud slopes up;</li>
<li>Negative correlation: data cloud slopes down;</li>
<li>High positive or negative correlation: data cluster tightly around a sloped line</li>
<li>Not affected by changes of scale: cm vs.&nbsp;inch, etc.</li>
</ul></li>
</ul>
<p>Range of Correlation is between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span></p>
<ul>
<li>Look at the graphs below for examples of high and low positive and negative correlations.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/corrdummies.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>From <em>R for Dummies</em></figcaption>
</figure>
</div>
<p>The <code>plot()</code> function in R works using x and y coordinates.</p>
<ul>
<li>We have to tell R precisely at which x- and y- coordinates to place points (e.g., place a point at <code>x=20</code> and <code>y=40</code>)</li>
<li>In practice, we will generally supply R with a vector of x-coordindates and a vector of corresponding y-coordinates.</li>
</ul>
<p>To illustrate a scatterplot, we will examine the relationship between the Wave 1 and Wave 2 feeling thermometer scores in the field experiment, for just the control “No Contact” condition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset data to look at control only</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>controlonly <span class="ot">&lt;-</span> <span class="fu">subset</span>(marriage1, treatment <span class="sc">==</span> <span class="st">"No Contact"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>plot()</code>, we supply the x and y vectors.</p>
<ul>
<li><code>xlim</code> and <code>ylim</code> specify the range of the x and y axis.</li>
<li><code>pch</code> is the point type. You can play around with that number to view different plot types</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm1, <span class="at">y=</span>controlonly<span class="sc">$</span>therm2, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Relationship between W1 and  W2"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Wave 1"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Wave 2"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The correlation looks extremely high! It is positively sloped and tightly clustered.</p>
<p>In fact, if we use R’s function to quantify a correlation between two variables, we will see it is a correlation above .99, very close to the maximum value.</p>
<ul>
<li>By default, R calculate the “pearson” correlation coefficient, a number that will be between -1 and 1. It represents the strength of the linear association between two variables.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## use = "pairwise" means to use all observations where neither variable has missing NA data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(marriage1<span class="sc">$</span>therm1, marriage1<span class="sc">$</span>therm2, <span class="at">use =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.995313</code></pre>
</div>
</div>
<p>This high correlation was unusual for this type of data.</p>
<ul>
<li>Feeling thermometers suffer from low reliability. How a person answers the question at one point in time (perhaps 83) in Wave 1 often differs from the numbers they say when asked again at a future point in time in Wave 2. A person’s responses often aren’t that stable.</li>
<li>Because there was such a high correlation, it suggested that the data might not have been generated by real human responses</li>
</ul>
</section>
<section id="histograms" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="histograms"><span class="header-section-number">4.6</span> Histograms</h2>
<p>The researchers later discovered the Wave 1 data was suspiciously correlated with an existing survey: 2012 CCAP.</p>
<ul>
<li>They believe the researcher likely used CCAP for Wave 1 - used survey responses from real humans that took a real survey – but not the humans that the researcher claimed to interview in the experiment.</li>
<li>Then the researcher generated the Wave 2 data by adding random noise to the Wave 1 data</li>
<li>Part of why they believe this has to do with a histogram plot they generated to compare Waves 1 and 2</li>
</ul>
<p>A histogram is a useful plot for summarizing the distribution of a single variable.</p>
<ul>
<li>It shows the frequency of observations (e.g., the number of survey respondents) who give an answer within a particular interval of numeric values</li>
</ul>
<p>Because a histogram is a single variable summary, we just supply R with the numeric variable we want to summarize.</p>
<ul>
<li>The new argument here <code>breaks</code> tells R how many of the individual rectangles we want. You can play around with that number to see how the plot changes.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm1, <span class="at">breaks=</span><span class="dv">50</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"W1 Histogram"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x=</span>controlonly<span class="sc">$</span>therm2,<span class="at">breaks=</span><span class="dv">50</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"W2 Histogram"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The researchers noticed that the heaping patterns were different between Wave 1 and Wave 2.</p>
<ul>
<li>When real humans answer these types of feeling thermometer questions, we often see heaping (tall spikes) at values of 0, 50, and 100. Humans tend to gravitate toward those nice round numbers to anchor their responses. In addition, often researchers might recode people with missing responses (people who skip a question), as having a score of 50, increasing the number at that point.
<ul>
<li>Wave 1 has a lot of this heaping– look at the higher bars around 0, 50, and 100, suggesting a lot of survey respondents gave those answers.</li>
<li>However, Wave 2 has less heaping, particularly at 50. This suggested to the researchers that the Wave 2 data were likely generated by a computer and not real humans</li>
</ul></li>
</ul>
<section id="happy-research-ending" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="happy-research-ending"><span class="header-section-number">4.6.1</span> Happy research ending</h3>
<p>While the original article was retracted</p>
<ul>
<li>Researchers who found irregularities received funding to conduct similar studies with real data this time</li>
<li>Multiple publications suggest the canvassing approach was effective:
<ul>
<li>Broockman and Kalla. 2016. “Durably reducing transphobia: A field experiment on door-to-door canvassing” Science 352 no. 6282.</li>
<li>Broockman and Kalla. 2020. “Reducing exclusionary attitudes through interpersonal conversation: evidence from three field experiments.” American Political Science Review</li>
<li>Kalla and Broockman. 2021. “Which narrative strategies durably reduce prejudice? Evidence from field and survey experiments supporting the efficacy of perspective-getting.” American Journal of Political Science. Forthcoming.</li>
</ul></li>
</ul>
</section>
</section>
<section id="line-plots" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="line-plots"><span class="header-section-number">4.7</span> Line Plots</h2>
<p>In this application, we will create a line plot in R. Line plots are built very similarly to scatterplots. We provide R an input of values for the x-axis and corresponding values on the y-axis.</p>
<p>For example, if we wanted to plot the US life expectancy for the past few years from 2018-2023 from , we could do the following based on data from the National Center for Health Statistics https://www.cdc.gov/nchs/fastats/life-expectancy.htm:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>yvalues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">78.7</span>, <span class="fl">78.8</span>, <span class="dv">77</span>, <span class="fl">76.4</span>, <span class="fl">77.5</span>, <span class="fl">78.4</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Key to making this a line plot is type="l"</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>years,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>yvalues,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"US Life Expectancy by year"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Year"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Life Expectancy at birth"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">2</span> ) <span class="co"># orientation of axis labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Alternate approach is to customize axis</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>yvalues,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"US Life Expectancy by year"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Year"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Life Expectancy at birth"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">2</span>, <span class="co"># orientation of axis labels</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">"n"</span>) <span class="co"># remove original axis</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">labels =</span> years) <span class="co"># label points only at relevant ticks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The two vectors of values may come from variables in your data or may come from calculations you make using those variables.</p>
<p>Let’s do a more complex example and break this down step by step.</p>
</section>
<section id="application-trends-during-covid" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="application-trends-during-covid"><span class="header-section-number">4.8</span> Application: Trends during COVID</h2>
<p>Since the onset of the pandemic in 2020, researchers have evaluated attitudinal and behavioral responses to policy changes, political messages, and COVID case/hospitalization/death rates.</p>
<ul>
<li>Survey data on attitudes and self-reported behavior</li>
<li>Health care provider administrative data</li>
<li>Mobile phone data to track locations</li>
<li>Social media data to track attitudes and mobility</li>
</ul>
<p><strong><em>Example: Using Survey data from over 1.1 million responses</em></strong> to measure concern about the coronavirus over time.</p>
<ul>
<li>Clinton, Joshua, et al.&nbsp;“<a href="https://www.science.org/doi/10.1126/sciadv.abd7204">Partisan pandemic: How partisanship and public health concerns affect individuals’ social mobility during COVID-19</a>.” Science advances 7.2 (2021): eabd7204.</li>
</ul>
<p><img src="images/covidsurvey.png" class="img-fluid"></p>
<p><strong><em>Example: Using the geotracking data of 15 million smartphones</em></strong> per day to compute percentage reduction in general movement and visiting non-essential services relative to before COVID-19 (before March 9).</p>
<ul>
<li>Gollwitzer, Anton, et al.&nbsp;“<a href="https://www.nature.com/articles/s41562-020-00977-7">Partisan differences in physical distancing are linked to health outcomes during the COVID-19 pandemic</a>.” Nature human behaviour 4.11 (2020): 1186-1197.</li>
</ul>
<p><img src="images/covidphone.png" class="img-fluid"></p>
<p><strong><em>Example: Using Twitter geolocation data</em></strong> to track how much movement users have by looking at the distances from all locations where a given user has tweeted.</p>
<ul>
<li>Paiheng Xu, Mark Dredze, David A Broniatowski. “<a href="https://socialmobility.covid19dataresources.org/">The Twitter Social Mobility Index: Measuring Social Distancing Practices from Geolocated Tweets</a>.” Journal of Medical Internet Research (JMIR), 2020.</li>
</ul>
<p><img src="images/covidtwitter.png" class="img-fluid"></p>
<p>We will use the Twitter social mobility index to study how the movement of geo-located Twitter users changed from 2019 into April 2022.</p>
<ul>
<li>We will compare this movement for users located in the Northeast vs.&nbsp;South</li>
</ul>
<p>Each row of the dataset represents a week of the year. Each column represents a particular geography for which social mobility was calculated by the researchers.</p>
<ul>
<li><code>Dates</code> indicates the date</li>
<li><code>Northeast</code>: social mobility data for those in the northeast of the U.S.</li>
<li><code>South</code>: social mobility data for those in the south of the U.S.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the data from the author Mark Dredze's website</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/mdredze/covid19_social_mobility.github.io/master/data/longitudinal_compiled.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like we have encountered numeric, factor, and character variables, R also has the ability to treat variables specifically as dates. We will want R to treat the date variable we read in as a date, and not as raw text or some other variable type. To do this, we will use the <code>as.Date</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Date variable original format and class</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(covid<span class="sc">$</span>Dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-01-01" "2022-12-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid<span class="sc">$</span>Dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(covid<span class="sc">$</span>Dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert to class Date</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>covid<span class="sc">$</span>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(covid<span class="sc">$</span>Date)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid<span class="sc">$</span>Dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(covid<span class="sc">$</span>Dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date"</code></pre>
</div>
</div>
<p>The researchers continue to add to these data. Let’s look at the portion of data from 2019 to April 2022.</p>
<ul>
<li>Note the use of <code>as.Date</code> again to make sure R knows our text should be treated as a date</li>
<li>Note the use of the greater than or equal to <code>&gt;=</code> and less than or equal signs <code>&lt;=</code> to specify which rows we want to keep in the data. We want rows that are in dates after January 1, 2019 and (<code>&amp;</code>) on or before April 25, 2022.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>covidsub <span class="ot">&lt;-</span> <span class="fu">subset</span>(covid, Dates <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2019-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                     Dates <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2022-04-25"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These data are collected by week. That is very detailed. While that may be useful, let us create another variable that contains just the month and year, which will allow us to calculate the average per month. With a date variable, we can use the <code>format</code> function to change the format to just year and month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>covidsub<span class="sc">$</span>monthyear <span class="ot">&lt;-</span> <span class="fu">format</span>(covidsub<span class="sc">$</span>Dates, <span class="st">"%Y-%m"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(covidsub<span class="sc">$</span>monthyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-01" "2022-04"</code></pre>
</div>
</div>
<p>Where we are going …</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Starting from basics …</p>
<ul>
<li>Let’s first create a scatterplot by providing R with our two variables</li>
<li>In a trend/line plot, we want each month on the x-axis</li>
<li>We want our outcome on the y-axis, in this case, average social mobility by month</li>
<li>Ultimately we will want to compare the Northeast with the South. We will plot one line at a time, starting with the Northeast</li>
</ul>
<p>We first need to find the average by month. Recall our <code>tapply()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mobilitybymonthNE <span class="ot">&lt;-</span> <span class="fu">tapply</span>(covidsub<span class="sc">$</span>Northeast, covidsub<span class="sc">$</span>monthyear, mean,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.rm=</span>T)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>mobilitybymonthSO <span class="ot">&lt;-</span> <span class="fu">tapply</span>(covidsub<span class="sc">$</span>South, covidsub<span class="sc">$</span>monthyear, mean,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the output for the Northeast. Each value is what we ultimately want on the y-axis– the average social mobility in a given month.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mobilitybymonthNE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 2019-01  2019-02  2019-03  2019-04  2019-05  2019-06  2019-07  2019-08 
51.22066 52.26420 63.20130 61.38417 61.27622 60.49753 58.91779 61.20730 
 2019-09  2019-10  2019-11  2019-12  2020-01  2020-02  2020-03  2020-04 
54.44546 54.93814 56.59830 55.44538 51.12414 45.80660 34.55917 18.15076 
 2020-05  2020-06  2020-07  2020-08  2020-09  2020-10  2020-11  2020-12 
23.29190 28.71901 27.02149 32.73828 29.07536 32.07877 29.83641 30.56208 
 2021-01  2021-02  2021-03  2021-04  2021-05  2021-06  2021-07  2021-08 
28.75507 28.76227 35.35340 45.02537 48.19897 50.18401 52.96105 51.19241 
 2021-09  2021-10  2021-11  2021-12  2022-01  2022-02  2022-03  2022-04 
45.81695 49.15654 48.69051 51.24941 46.96813 53.55241 59.70933 54.04312 </code></pre>
</div>
</div>
<p>We want to plot them each at their own point on the x-axis, from the first month to the last month. We can start by creating a vector of the same length as we have months:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
[26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40</code></pre>
</div>
</div>
<p>These become our two inputs in the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE, <span class="at">pch=</span><span class="dv">16</span>) <span class="co"># pch is point type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now transform it to a line by specifying <code>type="l"</code></p>
<ul>
<li>By default, R creates a plot with <code>type=p</code> for points. R also has <code>type=b</code> which has both a line and points.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE, <span class="at">type=</span><span class="st">"l"</span>) <span class="co"># makes it a line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let us change the aesthetics a bit by adding labels and removing the border with <code>bty="n"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Social Mobility by Month and Region"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Twitter Social Mobility Index"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">""</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="co"># y-axis limits</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, <span class="co"># orientation of axis labels</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, <span class="co"># line width</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">"n"</span>) <span class="co"># removes border</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s add a comparison line with the <code>lines()</code> function to look at trends for the south.</p>
<ul>
<li>Note that this is outside of the <code>plot()</code> function, but the inputs are very similar. We supply a set of x and y coordindates.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Social Mobility by Month and Region"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Twitter Social Mobility Index"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">""</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>), <span class="co"># y-axis limits</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, <span class="co"># orientation of axis labels</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, <span class="co"># line width</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">"n"</span>) <span class="co"># removes border</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Add line to the plot </span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthSO),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthSO, <span class="at">col=</span><span class="st">"red3"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s create our own axis for the plot to add detail. To do this, we add <code>xaxt</code> to the <code>plot</code> function and then use <code>axis()</code> below the function.</p>
<p>The labels we will add are the actual months in the data. These happen to be the labels or <code>names</code> of our vectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mobilitybymonthNE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2019-01" "2019-02" "2019-03" "2019-04" "2019-05" "2019-06" "2019-07"
 [8] "2019-08" "2019-09" "2019-10" "2019-11" "2019-12" "2020-01" "2020-02"
[15] "2020-03" "2020-04" "2020-05" "2020-06" "2020-07" "2020-08" "2020-09"
[22] "2020-10" "2020-11" "2020-12" "2021-01" "2021-02" "2021-03" "2021-04"
[29] "2021-05" "2021-06" "2021-07" "2021-08" "2021-09" "2021-10" "2021-11"
[36] "2021-12" "2022-01" "2022-02" "2022-03" "2022-04"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Social Mobility by Month and Region"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Twitter Social Mobility Index"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">""</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, </span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">"n"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">"n"</span>) <span class="co"># removes original x-axis</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Add line to the plot </span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthSO),</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthSO, <span class="at">col=</span><span class="st">"red3"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="do">## add the axis the "1" means x-axis. A "2" would create a y-axis</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE), </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">names</span>(mobilitybymonthNE), <span class="at">las=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, let’s add a <code>legend()</code>. Now we’re here!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthNE,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Social Mobility by Month and Region"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Twitter Social Mobility Index"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">""</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">las=</span><span class="dv">1</span>, </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">2</span>, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">"n"</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">"n"</span>) <span class="co"># removes original x-axis</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Add line to the plot </span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthSO),</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>mobilitybymonthSO, <span class="at">col=</span><span class="st">"red3"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="do">## add the axis the "1" means x-axis. A "2" would create a y-axis</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mobilitybymonthNE), </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span><span class="fu">names</span>(mobilitybymonthNE), <span class="at">las=</span><span class="dv">2</span>)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Add legend, "bottomleft" indicates where on the plot to locate it</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Could use "topright" instead, for example</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>,  <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red3"</span>, <span class="st">"black"</span>), </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">"South"</span>, <span class="st">"Northeast"</span>), </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> .<span class="dv">7</span>, <span class="co"># size of legend</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visual-tips-and-tricks" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="visual-tips-and-tricks"><span class="header-section-number">4.9</span> Visual tips and tricks</h2>
<p>Recall we said the goals of visualization are to communicate information</p>
<ul>
<li>Transparently (show me the data!)</li>
<li>Quickly</li>
<li>Simply</li>
<li>Accurately</li>
<li>And with a little work: beautifully</li>
</ul>
<p>What NOT to communicate?</p>
<p><img src="images/honestrunway.jpeg" class="img-fluid" style="width:70.0%"></p>
<p>Claus Wilke provides an overview of rules of thumb to fall when creating a data visualization on the Serial Mentor <a href="https://serialmentor.com/dataviz/">website</a>.</p>
<p>An example is below</p>
<p><img src="images/ugbadwrong.png" class="img-fluid"></p>
<p>Overall, the best thing to do is to look at your visual from a consumer’s <a href="https://www.youtube.com/watch?v=nQJEp-k-ogs&amp;ab_channel=ArianaGrandeVevo">point of view</a>. You want your visuals to be intuitive enough for a viewer to be able to interpret it without too much help from you or explanatory text elsewhere in a paper or presentation. Our goal is to help consumers of our data understand the main takeaways of our research easily and accurately.</p>
<ul>
<li>We want to make sure our visuals always have informative labels that a lay person can understand (instead of technical variable names, we can use plain language)
<ul>
<li>We may need to add a legend or additional text to a visual to help with this</li>
</ul></li>
<li>We want to choose colors to convey information. We want to avoid colors that are hard to see or might distract consumers.</li>
<li>The axis dimensions should not be misleading. If the goal is to compare two or more plots to each other, we would want them to have similar axes, for example.</li>
</ul>
</section>
<section id="common-r-plotting-functions-and-arguments" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="common-r-plotting-functions-and-arguments"><span class="header-section-number">4.10</span> Common R plotting functions and arguments</h2>
<p>Here is a refresher of several of the functions and arguments we have come across.</p>
<p>Create a plot</p>
<ul>
<li><code>plot()</code>: for scatterplots and trend plots</li>
<li><code>barplot()</code>: for barplot comparisons across categories</li>
<li><code>boxplot()</code>: boxplot for summaries of numeric variables</li>
<li><code>hist()</code>: for histogram summaries of a single numeric variable</li>
</ul>
<p>Aesthetic arguments within a plot</p>
<ul>
<li><code>main =</code>: Specifies the main title of the plot. Supply text (e.g., <code>main = "my title"</code>)</li>
<li><code>ylab =</code>: Specifies the title of the y-axis. Supply text (e.g., <code>ylab = "Mean of variable"</code>)</li>
<li><code>xlab =</code>: Specifies the title of the x-axis. Supply text (e.g., <code>xlab = "X variable name"</code>)</li>
<li><code>ylim =</code>: Specifies the range of the y-axis. Supply vector of two numbers (e.g., <code>ylim = c(0, 100)</code>)</li>
<li><code>xlim =</code>: Specifies the range of the x-axis. Supply vector of two numbers (e.g., <code>xlim = c(0, 100)</code>)</li>
<li><code>bty="n"</code>: Removes the border box around the plot</li>
<li><code>cex</code>, <code>cex.main</code>, <code>cex.names</code>, <code>cex.lab</code>, <code>cex.axis</code>: Changes the size of different elements of a plot. Default is 1, so a value of .8 would be smaller than default, and 1.2 would be bigger than normal.</li>
<li><code>type =</code>: Specifies the type of plot (e.g., <code>type="l"</code> is a line plot, <code>type="b"</code> is a plot with points and lines connecting them)</li>
<li><code>lwd=</code>: Specifies the width of a line on a plot. Default is 1. E.g., <code>lwd=3</code> makes a line much thicker</li>
<li><code>pch=</code>: Specifies the point type. E.g., <code>pch=15</code></li>
<li><code>lty=</code>: Specifies the line type. E.g., <code>lty=2</code> is a dashed line</li>
<li><code>col=</code>: Specifies the color of the central element of the plot. Can take a single color or vector of colors. Use <code>colors()</code> in the console to see all R colors.</li>
<li><code>names</code>: Specifies a set of labels in a barplot</li>
</ul>
<p>Ways to annotate a plot (generally added below the initial plotting function)</p>
<ul>
<li><code>abline()</code>: Adds a line to the plot at a particular point on the x- or y- intercept, either horizontal, vertical, or of a particular slope
<ul>
<li>Example: Adding a horizontal line at a particular at a y value of 2 <code>abline(h=2)</code></li>
<li>Example: Adding a vertical line at a particular at a x value of 2 <code>abline(v=2)</code></li>
</ul></li>
<li><code>lines(x=, y=)</code>: Adds a line connecting pairs of x- and y-coordinates. We used this to add the South line to the social mobility plot.</li>
<li><code>axis()</code>: Used to replace the default x- or y- axis that R will create with a customized axis
<ul>
<li>To create an original y-axis, use <code>axis(2, vectorofvalues, labels)</code> and specify <code>yaxt="n"</code> inside the plotting function to remove the original y-axis.</li>
<li>To create an original x-axis, use <code>axis(1, vectorofvalues, labels)</code> and specify <code>xaxt="n"</code> inside the plotting function to remove the original x-axis.</li>
</ul></li>
<li><code>legend()</code>: Adds a legend to a plot. Can specify the location as the first argument (e.g., <code>"bottomleft"</code> or <code>"topright"</code>)</li>
<li><code>text()</code>: Adds text to a plot at specific x- and y- locations. (E.g., <code>text(x=3, y=4, "Here is a point"</code>). The x and y arguments can be single numbers or a vector of numbers. x and y need to be the same length.</li>
<li><code>points()</code>: Adds points to a plot at specific x- and y- locations. Inputs are much like <code>plot</code></li>
</ul>
</section>
<section id="a-note-on-ggplot" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="a-note-on-ggplot"><span class="header-section-number">4.11</span> A note on <code>ggplot</code></h2>
<p>R has a number of open-source packages that people can use to expand the set of capabilities for visualization and analysis. These can be installed through RStudio. We will look at one of these packages: <code>ggplot2</code>.</p>
<p><strong><em>Using ggplot will be extra-credit at this point in the course. We may return to it later in the semester as part of the main curriculum. Reviewing this section of the notes is optional.</em></strong></p>
<p>The “gg” in ggplot2 stands for the “Grammar of Graphics.” This program provides another framework for creating figures in R. According to Hadley Wickham, “ggplot2 provides beautiful, hassle-free plots that take care of fiddly details like drawing legends.”</p>
<p>Practically speaking, <code>ggplot()</code> is another tool to plot the same types of figures we have been making in class. Some people prefer <code>ggplot2</code> because they find the logic of building figures more intuitive using this framework and/or more aesthetically pleasing. However, both <code>ggplot()</code> and the plots we have been making in class can accomplish the same ultimate goals of data visualization– to communicate information transparently, quickly, accurately, simply, and beautifully. Which types of plots you may prefer is up to your own taste.</p>
<p>Think of packages like apps on a smartphone.</p>
<ul>
<li>If RStudio is our smartphone, we install a package like you install an app on the phone. You only have to do this once, though occasionally you may want or need to update the installation to a new version.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run this line in your R console</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On a smartphone, every time you want to use an app after you have installed it, you have to open the app. Similarly, every time we want to open a package in RStudio, we have to open it by using the <code>library()</code> command</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Add and run this line in your R script, above the code where you will use functions from the package</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The main plotting function in <code>ggplot2</code> is the <code>ggplot()</code> function. It will give you access to barplots, boxplots, scatterplots, histograms, etc.</p>
<ul>
<li>The syntax within this package is a little different from the base R plotting functions. We will investigate below. For now, here is an example of using <code>ggplot</code> to create a boxplot using the experiment on social status from earlier in this section.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>status, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>econcon)) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The three primary components of a ggplot() are a dataframe (<code>data =</code>), a set of mapping aesthetics (<code>aes()</code>), and <code>geoms</code> (e.g., geom boxplot, geom bar, geom point, geom line, etc.).</p>
<ul>
<li>The function <code>ggplot()</code> first takes a dataframe that includes the values you would like to plot (e.g., <code>data = status</code>).</li>
<li>The aesthetics then include the variable names that you want to plot on the x and y axis (e.g., <code>aes(x=condition, y=econcon)</code>)
<ul>
<li>Additional mapping aesthetics can be specified. For example, a third variable (or a repeat of a previous variable) can also be specified (e.g., <code>fill =</code>, <code>colour =</code>, <code>shape =</code>), which acts as a grouping variable. If this is specified, <code>ggplot()</code> will create a corresponding legend for the plot and will color/make different shapes for different groups within this third variable (See the boxplot below for an example of grouping by condition).</li>
</ul></li>
<li>After closing out the first <code>ggplot()</code> parentheses, you then annotate the plot by adding (<code>+</code>) a geometric layer. This is essentially where you specify the type of plot (though it is possible to have multiple geometric layers).</li>
<li>Just like with the other plotting functions in R, you can also specify a number of other arguments to make your plot more informative and aesthetically pleasing. Here, you do this by adding (<code>+</code>) additional arguments. See examples below (e.g., <code>ggtitle</code>, <code>xlab</code>, <code>ylab</code> for titles, <code>ylim</code> for y-axis limits, etc.)</li>
<li>Likewise, just like with the other plotting functions, you can save your plots as a pdf or png. To do so here, you include the line <code>ggsave()</code> just below your plot.</li>
</ul>
<p>There are many more possibilities for plotting with <code>ggplot()</code>, but these should get you started. For additional resources on all that is gg, I recommend the <a href="https://%20r-graphics.org/">R Graphics Cookbook</a>.</p>
<p>Here is a second version of the boxplot with more aesthetics specified.</p>
<ul>
<li>We will color in the boxes based on the collapsed condition variable.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>status, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>condition, <span class="at">y=</span>econcon, <span class="at">fill=</span>conditionnew)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Specifies plot type. E.g., also have geom_point(), geom_bar()</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note many arguments are similar to other R functions but the syntax is a little different</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Economic Views by Experimental Condition"</span>)<span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Economic Views"</span>)<span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Experimental Condition"</span>)<span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Changes the overall theme (i.e., color scheme, borders, etc.)</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"myboxplot.pdf"</span>, <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is an example of a histogram from the application on views toward gay couples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(controlonly, <span class="fu">aes</span>(<span class="at">x=</span>therm1)) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"W1 Histogram"</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Instead of displaying multiple categories through different shapes or colors, we could also create multiple mini plots instead. This is done through <code>facet</code>. Let’s look at a histogram for each condition for the thermometers in wave 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marriage1, <span class="fu">aes</span>(<span class="at">x=</span>therm2)) <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"W2 Histogram by Condition"</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Feeling Thermometer Wave 2"</span>)<span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatmentnew)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1042 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can similarly create a scatter and line plot. Let’s use the social mobility data. Here we see <code>geom_point</code> and <code>geom_line</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Scatterplot</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covidsub, <span class="fu">aes</span>(<span class="at">x=</span>Dates, <span class="at">y=</span>avg_USA)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Social Mobility in US"</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Avg Social Mobility"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Line plot</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covidsub, <span class="fu">aes</span>(<span class="at">x=</span>Dates, <span class="at">y=</span>avg_USA)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Social Mobility in US"</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>)<span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Avg Social Mobility"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Visualization_files/figure-html/unnamed-chunk-50-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03-CausalityI.html" class="pagination-link" aria-label="Causation with Experiments">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Causation with Experiments</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-Causalityii.html" class="pagination-link" aria-label="Causality with Non-Experimental Data">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Causality with Non-Experimental Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>